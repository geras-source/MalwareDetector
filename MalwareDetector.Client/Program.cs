using Microsoft.Extensions.Configuration;
using System;
using System.IO;

namespace MalwareDetector.Client
{
    class Program
    {
        static void Main(string[] args)
        {
            var directoryPath = args[1];
            var command = args[0];
            DirectoryInfo directory = new DirectoryInfo(directoryPath);
            
            if (args.Length <= 1 || args.Length > 2 || directoryPath.IndexOfAny(Path.GetInvalidPathChars()) != -1)
            {
                Console.WriteLine("Отсуствует аргумент или он неправильный");
                return;
            }
            
            IConfiguration config = new ConfigurationBuilder()
                    .AddJsonFile("appsettings.json", optional: false, reloadOnChange: false).Build();
            var httpService = new HttpService.HttpService(config);
            
            if (command.ToLower() != "scan" && command.ToLower() != "status")
            {
                Console.WriteLine("Не правильная команда");
                return;
            }
            else if (command.ToLower() == "scan")
            {
                if (!directory.Exists)
                {
                    Console.WriteLine("Данный путь не существует");
                    return;
                }
                var scanId = httpService.SendFilesToScan(directoryPath).Result;
                Console.WriteLine($"Сканирование было запущено с идентификатором: {scanId}");
            }
            else if (command.ToLower() == "status")
            {
                var scanId = args[1];
                Console.WriteLine(httpService.GetStatusScan(scanId).Result);
            }
            
        }
    }
}